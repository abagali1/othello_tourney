# WARNING: Do not edit this file manually! Edit ci/spec.yml and run ci/regen-workflow.py.

{"name": "CI", "on": ["push", "pull_request"], "defaults": {"run": {"shell": "bash"}}, "jobs": {"format": {"runs-on": "ubuntu-latest", "strategy": {"matrix": {"python-version": [3.8, 3.9]}}, "steps": [{"name": "Set up repo", "uses": "actions/checkout@v2"}, {"name": "Set up Python ${{ matrix.python-version }}", "uses": "actions/setup-python@v2", "with": {"python-version": "${{ matrix.python-version }}"}}, {"name": "Set up pip cache", "uses": "actions/cache@v2", "with": {"path": "~/.cache/pip\n~/.cache/pipenv\n", "key": "${{ matrix.python-version }}"}}, {"name": "Set up venv", "run": "set -e\npip install pipenv\npipenv install --dev --deploy\n"}, {"name": "Check formatting with format.sh", "run": "pipenv run ./scripts/format.sh && test -z \"$(git status --porcelain=v1 .)\""}]}, "test": {"runs-on": "ubuntu-latest", "strategy": {"matrix": {"python-version": [3.8, 3.9]}}, "services": {"redis": {"image": "redis:latest", "ports": ["6379:6379"], "options": "--entrypoint redis-server"}, "postgres": {"image": "postgres:alpine", "env": {"POSTGRES_USER": "othello", "POSTGRES_DB": "othello", "POSTGRES_PASSWORD": "pwd"}, "ports": ["5432:5432"], "options": "--health-cmd pg_isready --health-interval 6s --health-timeout 5s --health-retries 9"}}, "steps": [{"name": "Set up repo", "uses": "actions/checkout@v2"}, {"name": "Set up Python ${{ matrix.python-version }}", "uses": "actions/setup-python@v2", "with": {"python-version": "${{ matrix.python-version }}"}}, {"name": "Set up pip cache", "uses": "actions/cache@v2", "with": {"path": "~/.cache/pip\n~/.cache/pipenv\n", "key": "${{ matrix.python-version }}"}}, {"name": "Set up venv", "run": "set -e\npip install pipenv\npipenv install --dev --deploy\n"}, {"name": "Copy secret.py", "run": "cp othello/settings/secret.sample.py othello/settings/secret.py"}, {"name": "Migrate database", "run": "pipenv run python3 manage.py migrate"}, {"name": "Collect static files", "run": "pipenv run python3 manage.py collectstatic --noinput -v 0"}, {"name": "Run tests", "run": "pipenv run coverage run ./manage.py test"}, {"name": "Report coverage to Coveralls", "uses": "AndreMiras/coveralls-python-action@develop", "with": {"parallel": true}}]}, "finish_success": {"needs": ["format", "test"], "runs-on": "ubuntu-latest", "steps": [{"name": "Tell Coveralls that parallel jobs have finished", "uses": "coverallsapp/github-action@master", "with": {"github-token": "${{ secrets.GITHUB_TOKEN }}", "parallel-finished": true}}]}}}